@{
    @model IEnumerable<RealEstateListingApp.Models.Properties>
    var wishlist = ViewData["Wishlist"] as List<int>;
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@Html.Raw(TempData["AddWishlist"])


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<style>
    .property-card {
        width: 300px; /* Fixed width */
        height: 370px; /* Fixed height */
        margin: 10px auto;
        border: 1px solid #ddd;
        padding: 10px;
        border-radius: 8px;
    }

        .property-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .property-card .carousel-item {
            width: 100%;
            height: 200px;
        }

            .property-card .carousel-item img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

        .property-card .main-button {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .property-card .wishlist-icon {
            color: red;
        }

    .property-card {
        overflow: hidden;
        transition: transform 0.3s ease;
    }

        .property-card:hover {
            transform: scale(1.05);
        }
</style>

<div class="main-banner">
    <div class="owl-carousel owl-banner">
        <div class="item item-1">
            <div class="header-text">
                <span class="category"><em>Ahamadabad</em></span>
                <h2>Hurry!<br>Get the Best Villa for you</h2>
            </div>
        </div>
        <div class="item item-2">
            <div class="header-text">
                <span class="category"><em>Surat</em></span>
                <h2>Be Quick!<br>Get the best villa in town</h2>
            </div>
        </div>
        <div class="item item-3">
            <div class="header-text">
                <span class="category"><em>Mumbai</em></span>
                <h2>Act Now!<br>Get the highest level penthouse</h2>
            </div>
        </div>
    </div>
</div>

<div class="featured section">
    <div class="container">
        <div class="row">
            <div class="col-lg-4">
                <div class="left-image">
                    <img src="~/assets/images/featured.jpg" alt="">
                    <a href="property-details.html"><img src="~/assets/images/featured-icon.png" alt="" style="max-width: 60px; padding: 0px;"></a>
                </div>
            </div>
            <div class="col-lg-5">
                <div class="section-heading">
                    <h6>| Featured</h6>
                    <h2>Best Appartment &amp; Sea view</h2>
                </div>
                <div class="accordion" id="accordionExample">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingOne">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                Best useful links ?
                            </button>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                            <div class="accordion-body">
                                Get <strong>the best villa</strong> website template in HTML CSS and Bootstrap for your business. TemplateMo provides you the <a href="https://www.google.com/search?q=best+free+css+templates" target="_blank">best free CSS templates</a> in the world. Please tell your friends about it.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingTwo">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                How does this work ?
                            </button>
                        </h2>
                        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                            <div class="accordion-body">
                                Dolor <strong>almesit amet</strong>, consectetur adipiscing elit, sed doesn't eiusmod tempor incididunt ut labore consectetur <code>adipiscing</code> elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingThree">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                Why is Villa Agency the best ?
                            </button>
                        </h2>
                        <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
                            <div class="accordion-body">
                                Dolor <strong>almesit amet</strong>, consectetur adipiscing elit, sed doesn't eiusmod tempor incididunt ut labore consectetur <code>adipiscing</code> elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="info-table">
                    <ul>
                        <li>
                            <img src="~/assets/images/info-icon-01.png" alt="" style="max-width: 52px;">
                            <h4>250 m2<br><span>Total Flat Space</span></h4>
                        </li>
                        <li>
                            <img src="~/assets/images/info-icon-02.png" alt="" style="max-width: 52px;">
                            <h4>Contract<br><span>Contract Ready</span></h4>
                        </li>
                        <li>
                            <img src="~/assets/images/info-icon-03.png" alt="" style="max-width: 52px;">
                            <h4>Payment<br><span>Payment Process</span></h4>
                        </li>
                        <li>
                            <img src="~/assets/images/info-icon-04.png" alt="" style="max-width: 52px;">
                            <h4>Safety<br><span>24/7 Under Control</span></h4>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="properties section">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 offset-lg-4">
                <div class="section-heading text-center">
                    <h6>| Properties</h6>
                    <h2>We Provide The Best Property You Like</h2>
                </div>
            </div>
        </div>

        <div class="row">
            @foreach (var property in Model)
            {
                var isInWishlist = wishlist != null && wishlist.Contains(property.PropertyID);

                <input type="hidden" asp-for="@property.PropertyID" />
                <div class="col-lg-4 col-md-6">
                    <div class="property-card">
                        <img src="@property.Images.FirstOrDefault()" class="d-block w-100" alt="...">
                        @*               <div id="carousel-@property.PropertyID" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                    @for (int i = 0; i < property.Images.Count; i++)
                    {
                    <div class="carousel-item @(i == 0 ? "active" : "")">
                    <img src="@property.Images[i]" class="d-block w-100" alt="...">
                    </div>
                    }
                    </div>
                    <a class="carousel-control-prev" href="#carousel-@property.PropertyID" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carousel-@property.PropertyID" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                    </a>
                    </div> *@
                        <span class="category"><strong>@property.PropertyName</strong></span>
                        <ul>
                            <li>Property Type : <span>@property.Type</span></li>
                        </ul>
                        <span>Rs. @property.Price</span>

                        <div class="d-flex justify-content-between">
                            <div class="main-button">
                                <a asp-action="PropertyDetails" asp-controller="User" asp-route-id="@property.PropertyID">View Details</a>
                            </div>
                      @*       <a href="javascript:void(0);"
                               class="wishlist-icon mt-2"
                               data-property-id="@property.PropertyID"
                               data-is-in-wishlist="@property.IsInWishlist"
                               onclick="toggleWishlist(this)">
                                <i class="fas fa-heart-o"></i>
                                <i class="bi @(property.IsInWishlist ? "bi-heart-fill" : "bi-heart") heart-icon"></i>
                            </a> *@
                            <a class="wishlist-icon mt-2 @(isInWishlist ? "in-wishlist" : "")" data-property-id="@property.PropertyID">
                                <i class="bi @(isInWishlist ? " bi-heart-fill text-danger" : "bi-heart")" style="cursor:pointer;"></i>
                            </a>
                        </div>
                        @* @((property.IsInWishlist) ? "bi-heart-fill" : "bi-heart") *@



                    </div>
                </div>
            }
            <div class="col-sm-12 col-md-12 text-center mt-4">
                <a asp-action="BuyProperty" asp-controller="User" class="btn btn-outline-primary">View More</a>
            </div>
        </div>

    </div>
</div>

@section Scripts {
    <script>
        // function toggleWishlist(element) {
        //     var propertyId = $(element).data("property-id");
        //     var isInWishlist = $(element).data("is-in-wishlist");

        //     if (isInWishlist) {
        //         removeFromWishlist(propertyId, element);
        //     } else {
        //         addToWishlist(propertyId, element);
        //     }
        // }

        // function addToWishlist(propertyId, element) {
        //     $.ajax({
        //         url: 'Url.Action("AddInWishlist", "User")',
        //         type: 'POST',
        //         data: { id: propertyId },
        //         success: function (response) {
        //             $(element).data("is-in-wishlist", true);
        //             $(element).find('i').removeClass('fa-heart-o').addClass('fa-heart');
        //             alert('Property added to wishlist');
        //         },
        //         error: function (xhr, status, error) {
        //             alert('Error adding to wishlist');
        //         }
        //     });
        // }

        // function removeFromWishlist(propertyId, element) {
        //     $.ajax({
        //         url: 'Url.Action("DeleteFromWishlist", "User")',
        //         type: 'POST',
        //         data: { id: propertyId },
        //         success: function (response) {
        //             $(element).data("is-in-wishlist", false);
        //             $(element).find('i').removeClass('fa-heart').addClass('fa-heart-o');
        //             alert('Property removed from wishlist');
        //         },
        //         error: function (xhr, status, error) {
        //             alert('Error removing from wishlist');
        //         }
        //     });
        // }

        $(document).ready(function () {
            $('.wishlist-icon').click(function () {
                var button = $(this);
                var propertyId = button.data('property-id');
                var isInWishlist = button.hasClass('in-wishlist');

                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("ToggleWishlist", "User")',
                    data: { propertyId: propertyId },
                    success: function (response) {
                        if (response.success) {
                            if (isInWishlist) {
                                button.removeClass('in-wishlist');
                                button.find('i').removeClass('bi-heart-fill text-danger').addClass('bi-heart');
                                alert('Property removed from your wishlist.');
                            } else {
                                button.addClass('in-wishlist');
                                button.find('i').removeClass('bi-heart').addClass('bi-heart-fill text-danger');
                                alert('Property added to your wishlist.');
                            }


                        } else {
                            alert(response.message);
                        }
                    },
                    error: function () {
                        alert('Error occurred while processing your request.');
                    }
                });

                return false; // Prevent default form submission
            });
        });

    </script>
}
